<html>
<head>
<title>Lobby</title>
<style>
        table, td {
          border: 1px solid black;
        }
        </style>
</head>

<body>
    <button id="refreshButton" type="button">Refresh rooms</button>
    <button id="createRoomButton" type="button">Create room</button>
</body>
<br>
<table id="rooms">
</table>

</html>
<script src="/socket.io/socket.io.js"></script>
<script>
    let socket = io();
    socket.on('clt-user_connected', function () {
        socket.emit('clt-user_lst_rooms');
    });

    socket.on('srv-srv_lst_rooms', function (data) {
        updateTable(data);
    });

    document.getElementById("refreshButton").onclick = function() { refresh(); };
    document.getElementById("createRoomButton").onclick = function() { createRoom(); } ;

    const refresh = () => {
        socket.emit('clt-user_lst_rooms');
    }

    socket.on('srv-srv_crt_room', function () {
        refresh();
    });

    const createRoom = () => {
        socket.emit('clt-user_crt_room');
        //TODO move client to the lobby.
    }

    const updateTable = (data) => {
        const table = document.getElementById("rooms");
        if(data.length == 0) {
            table.innerHTML = "";
            table.innerHTML += "No lobbies found.";
        } else {
        table.innerHTML = "";
        for (i = 0; i < (data.length); i++) { 
            table.innerHTML += "<tr><td>" + data[i].id + "</td><td><button>" + data[i].joinUrl + "</button></td></tr>";
            }
        }   
    }
</script>